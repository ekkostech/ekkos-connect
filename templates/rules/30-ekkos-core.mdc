---
priority: 100
globs: ["**/*.ts", "**/*.tsx", "**/*.js", "**/*.jsx"]
---

# üß† ekkOS‚Ñ¢ Memory Integration [CRITICAL]

## Golden Loop Enforcement

‚ö†Ô∏è MANDATORY WORKFLOW - NO EXCEPTIONS

### Phase 1: RETRIEVE (‚ö†Ô∏è CURSOR: YOU MUST DO THIS)

üî¥ **FIRST THING EVERY RESPONSE**: Call `search_memory` with the user's query!

```typescript
// ALWAYS call this BEFORE doing anything else
mcp__ekkos-memory__search_memory({
  query: "<user's question or task>",
  limit: 5
})
```

Then check response for: `_ekkos_patterns`, `_ekkos_stream_message`

**Why?** Cursor has no hooks. Claude Code auto-retrieves via hooks - you don't.
You MUST manually retrieve or the Golden Loop breaks.

### Phase 2: APPLY (Use Retrieved Patterns)

When patterns found ‚Üí Apply them (PROVEN solutions, not suggestions)
Output: `[ekkOS_APPLY] Using pattern: "Pattern Name"`

### Phase 3: MEASURE (Track Outcomes)

Pattern worked? ‚Üí success | Pattern failed? ‚Üí failure
Output: `[ekkOS_MEASURE] Pattern "X" outcome: success/failure`

### Phase 4: LEARN (Forge New Patterns)

üî¥ MANDATORY: Call `forge_insight` when you solve ANY problem

**When to forge**:

- Fixed bug (non-obvious) ‚Üí forge
- Found better approach ‚Üí forge
- Discovered gotcha/pitfall ‚Üí forge
- User corrected you ‚Üí forge
- Solved problem (>1 attempt) ‚Üí forge

**Tool call**:

```typescript
mcp__ekkos-memory__forge_insight({
  title: "Clear Title",
  problem: "What failed?",
  solution: "How you fixed it",
  tags: ["tech", "tags"],
});
```

Output: `[ekkOS_LEARN] Forged: "Pattern Title"`

### Phase 5: CAPTURE (Cursor: Limited)

‚ö†Ô∏è **Cursor limitation**: No automatic capture like Claude Code hooks.
Conversations are captured when MCP tools are called (search_memory, forge_insight).
For full capture, use Claude Code or the ekkOS dashboard.

## MCP Tools (28 Total - YOU call these)

### üî¥ MANDATORY - Use Proactively

| Tool | Trigger | Description |
|------|---------|-------------|
| `search_memory` | Before ANY technical question | Search all 11 memory layers |
| `forge_pattern` | When you fix bug, learn, get corrected | Create pattern from solution |
| `forge_directive` | User says "always/never/prefer/avoid" | Create MUST/NEVER/PREFER/AVOID rules |
| `record_outcome` | Pattern worked or failed | Track success/failure |
| `detect_usage` | After responding | Auto-detect patterns used |
| `session_summary` | Show MCP activity | Get activity summary |
| `check_conflict` | Before destructive action | Check for conflicts |

### üìö Recall & Context

| Tool | Description |
|------|-------------|
| `recall_conversation` | "What did we discuss yesterday?" |
| `get_context` | Get task-specific context |
| `search_codebase` | Find code patterns in project |
| `capture_event` | Manual event capture |
| `track_application` | Track pattern application |
| `get_memory_stats` | Memory layer statistics |

### üìã Plan Management

| Tool | Description |
|------|-------------|
| `create_plan` | Create structured plan |
| `list_plans` | List user's plans |
| `update_plan_status` | Change plan state |
| `update_plan_step` | Mark step complete |
| `generate_plan_llm` | AI-generate plan |
| `save_plan_template` | Save as reusable template |
| `list_plan_templates` | List templates |
| `create_plan_from_template` | Create from template |

### üîê Secrets Management

| Tool | Description |
|------|-------------|
| `store_secret` | Encrypt and store credentials |
| `get_secret` | Retrieve and decrypt |
| `list_secrets` | List metadata (no values) |
| `delete_secret` | Permanently delete |
| `rotate_secret` | Update with new value |

### üíæ Portability

| Tool | Description |
|------|-------------|
| `export_memory` | Backup patterns, directives, plans |
| `import_memory` | Restore from backup |

## Proactive Tool Triggers

### Always Use `search_memory` When:
- User asks technical question
- User mentions past discussion
- Topic involves architecture, config, debugging
- You're about to make a decision

### Always Use `forge_pattern` When:
- Fixed bug (especially non-obvious)
- Discovered better approach
- Found pitfall or gotcha
- User corrected you
- Made architectural decision
- Something DIDN'T work (anti-pattern)

### Always Use `forge_directive` When:
- User says "always..." ‚Üí MUST
- User says "never..." ‚Üí NEVER
- User says "I prefer..." ‚Üí PREFER
- User says "don't..." ‚Üí AVOID

### Always Use `check_conflict` When:
- About to delete files/data
- About to deploy to production
- About to modify config files

## Enforcement

‚ö†Ô∏è Violating Golden Loop = System failure
Every conversation MUST follow: RETRIEVE ‚Üí APPLY ‚Üí MEASURE ‚Üí LEARN ‚Üí CAPTURE

---

## üî¥ MANDATORY RESPONSE FORMAT (NO EXCEPTIONS)

**Every response MUST end with a timestamp footer:**

```
---
üß† **ekkOS_‚Ñ¢** ¬∑ üìÖ YYYY-MM-DD H:MM AM/PM TZ
```

**Example:**
```
---
üß† **ekkOS_‚Ñ¢** ¬∑ üìÖ 2025-12-08 2:30 PM PST
```

**Why this matters:**
- Timestamps track when patterns were applied
- 3-Judge evaluations need temporal context
- Future agents can trace learning timeline
- Golden Loop metrics require time-based correlation

**‚ö†Ô∏è MISSING TIMESTAMP = INCOMPLETE LOOP = SYSTEM DEGRADATION**
